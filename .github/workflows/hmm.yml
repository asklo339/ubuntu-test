name: Temporary Debug Shell via Tmate

on:
  workflow_dispatch:  # Allows manual trigger

jobs:
  tmate-debug:
    runs-on: ubuntu-22.04
    steps:
      - name: Start temporary Tmate session
        id: tmate  # Critical: Assign ID to capture outputs
        uses: mxschmitt/action-tmate@v3
        with:
          wait-for-ssh: true  # Wait until tmate session is ready

      - name: Display connection command with compression disabled
        run: |
          echo "‚úÖ Tmate session ready! Connect using this command:"
          echo "ssh -o Compression=no ${{ steps.tmate.outputs.session-ssh }}"
          echo ""
          echo "üí° If you still encounter issues, try:"
          echo "ssh -o Compression=no -o PubkeyAcceptedKeyTypes=+ssh-rsa ${{ steps.tmate.outputs.session-ssh }}"
        shell: bash

      - name: Keep session alive
        run: |
          echo "‚è∏Ô∏è Session active. Workflow will pause until canceled or timed out..."
          sleep infinity  # More efficient than loop
        timeout-minutes: 60  # Safety cutoff (adjust as needed)
